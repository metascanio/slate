---
title: Metascan - API Reference - v1.04

language_tabs: # must be one of https://git.io/vQNgJ
  - shell
  - php
  - javascript

toc_footers:
  - <a href='https://metascan.io/signup/?lang=en'>Sign Up for a Developer Key</a>

search: true
---

# API Introduction 

> API endpoint:

```
https://api.metascan.io/
```

The Metascan Query Services `"MQS"` was created to facilitate the real-time lookup of IP and Domain threat data into various applications and services. Currently there are dozens of various domain and IP data-feeds available to developers. Many of these feeds are available free of charge and some are paid for services when minimum query levels are exceeded. In addition, there are 2 main problems with trying to incorporate multiple data feed into a solution:

1. The overlap between data feed providers in the content listed (IPs & URIs), and

2. The absence of normalized meta-data related to the IPs or Domains.

Because of the above, many developers asked if we could do something to reduce the complexity related to accessing and using threat data as part of their applications - MQS is our solution. We are introducing a _more elegant API for developers_, with an affordable pricing model to match.

To start, [signup for a developer key](https://metascan.io/signup/?lang=en) and begin to integrate MQS into your web-apps and mobile applications. 

# Authentication

> To authorize, use this code:

```shell
curl https://api.metascan.io/?key=YOURAPIKEY
```

```php
<?
$ch = curl_init();

curl_setopt($ch, CURLOPT_URL, 'https://api.metascan.io/?key=YOURAPIKEY');

curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);

$response = curl_exec($ch);
?>
```

```javascript

$.ajax({
type: 'GET',
url: 'https://api.metascan.io/?key=YOURAPIKEY',
dataType: 'JSON',
success: function(response) {
  console.log(response);
},

error: function(xhr, status, error) {
  console.log(error.toString());
}

});
```

All queries to MSQ require your API key specified as an argument. No API key? [Signup and receive](https://metascan.io/signup/?lang=en') a key instantly. 

> Make sure to replace `YOURAPIKEY` with your API key.

MSQ uses API keys to allow access to the service, and expects the API key to be included in all requests to the server.

<aside class="notice">
You must replace <code>YOURAPIKEY</code> with your personal API key.
</aside>

# API Overview

## Query formats

> Query end-points include 4 formatting options:

```
https://api.metascan.io/v1/check/http/
```

```
https://api.metascan.io/v1/check/text/
```

```
https://api.metascan.io/v1/check/json/
```

```
https://api.metascan.io/v1/check/jsonx/
```

You can issue requests to our endpoints from virtually any operating system or programming language. REST queries are extremely fast and provide the reachest set of information about an item. For example, the Spamhaus' CBL data is available only via REST JSONX query.

Each client has unique access key, generated by the system. You need to provide this key, if querying from an unregistered IP address. Requests from unregistered IP address are rejected, if not performed over HTTPS (secure).

There are four types of REST queries:

* HTTP
* Text
* JSON
* JSONX.

The type of desired query is passed in the HTTP request.

## IP Addresses

We provide four IPv4 and four IPv6 addresses, which will always return the same answers. Use those for testing and development:

* `127.9.9.1` - returning as if found in SBL, XBL & CBL
* `127.9.9.2` - returning as if in PBL
* `127.9.9.3` - returning as if in SBL subnet
* `127.9.9.4` - not found (good IP), also contains White List data
* `::1, ::2, ::3, ::4` - returning as above for IPv6.

## Domains

We provide two testing domains:

* `baddomain.org` - returns as if found in all domain DBs: DBL, and all URIBL

* `okdomain.org` - returns as if not found in any DB.



# HTTP Format

```shell
curl https://api.metascan.io/v1/check/http/baddomain.org?key=YOURAPIKEY
```

```php
<?
$ch = curl_init();

curl_setopt($ch, CURLOPT_URL, 'https://api.metascan.io/v1/check/http/baddomain.org?key=YOURAPIKEY');

curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);

$response = curl_exec($ch);
?>
```

```javascript
$.ajax({
type: 'GET',
url: 'https://api.metascan.io/v1/check/http/baddomain.org?key=YOURAPIKEY',
dataType: 'text',
success: function(response) {
  console.log(response);
},

error: function(xhr, status, error) {
  console.log(error.toString());
}

});
```

```text
HTTP 200 (OK).

If the item is not present in any black list, then the answer will be 204 (No Content).
```

HTTP returns very simple response - found or not, via HTTP response code. If found, the response will be 200 (OK).

If the item is not present in any black list, then the answer will be 204 (No Content).

Additional information about the item is found in the response headers. Check the Developers page for more information.

HTTP example - replace 'baddomain.org' with your query - IP or domain:

# Text Format

```shell
curl https://api.metascan.io/v1/check/text/baddomain.org?key=YOURAPIKEY
```

```php
<?
$ch = curl_init();

curl_setopt($ch, CURLOPT_URL, 'https://api.metascan.io/v1/check/text/baddomain.org?key=YOURAPIKEY');

curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);

$response = curl_exec($ch);
?>
```

```javascript
$.ajax({
type: 'GET',
url: 'https://api.metascan.io/v1/check/text/baddomain.org?key=YOURAPIKEY',
dataType: 'text',
success: function(response) {
  console.log(response);
},

error: function(xhr, status, error) {
  console.log(error.toString());
}

});
```

> The above example returns text in the format:

```text
127.9.9.4:false,true,med;metascan.io;99999,-0.1 127.9.9.1:true,false,,0.95,xbl,sbl
```

TEXT returns space separated blocks of information about the lists where the item is found.

Text example - replace 'baddomain.com' with your query - IP or domain:

Items are separated by space. The format for each item is:

`item:bool,bool,wldata,score,source`

Where:

* the first bool is true, if found in any black list,

* the second bool is true, if found in any white list,

* wldata contains the data from the white list, and

* score is followed by the list of sources where the item was found.

# JSON Format

```shell
curl https://api.metascan.io/v1/check/json/baddomain.org?key=yourkeygoeshere
```

```php
<?
$ch = curl_init();

curl_setopt($ch, CURLOPT_URL, 'https://api.metascan.io/v1/check/json/baddomain.org?key=YOURAPIKEY');

curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);

$response = curl_exec($ch);

echo json_decode($response);

?>
```

```javascript
$.ajax({
type: 'GET',
url: 'https://api.metascan.io/v1/check/json/baddomain.org?key=YOURAPIKEY',
dataType: 'JSON',
success: function(response) {
  console.log(response);
},

error: function(xhr, status, error) {
  console.log(error.toString());
}

});
```

```json
{
  "results": [{
    "item": "123.123.123.123",
    "found": true,
    "score": 0.2,
    "fromSubnet": true,
    "sources": ["shPBL"],
    "wl": false,
    "wldata": ""
  }],
  "executionTime": 2,
  "status": "success" 
}
```

JSON will return a JSON document with details about black lists, whether the item was found in a subnet, etc. See format explanation below. JSON example - replace 'baddomain.org' with your query - IP or domain:

JSON response:

Parameter | Description
--------- | -----------
Item | IP address
Found | True/False if found in MQS
Score | Score between -0.1 to 1.0. See [score information](#score-calculation)
FromSubnet | Will be true, if the IP address was found in a subnet (PBL, SBL)
Sources | Lists matched from MQS. [See list](#data-amp-access-methods) information.
Wl | To be specified
Wldata | To be specified
ExecutionTime | Time in ms for server response
Status | Success or failure

# JSONX Format

```shell
curl https://api.metascan.io/v1/check/jsonx/baddomain.org?key=yourkeygoeshere
```

```php
<?
$ch = curl_init();

curl_setopt($ch, CURLOPT_URL, 'https://api.metascan.io/v1/check/jsonx/baddomain.org?key=YOURAPIKEY');

curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);

$response = curl_exec($ch);

echo json_decode($response);

?>
```

```javascript
$.ajax({
type: 'GET',
url: 'https://api.metascan.io/v1/check/jsonx/baddomain.org?key=YOURAPIKEY',
dataType: 'JSON',
success: function(response) {
  console.log(response);
},

error: function(xhr, status, error) {
  console.log(error.toString());
}

});
```

JSONX will return also a JSON document, extended with additional information about the last known activity of an fraudulent IP address. There are no jsonx queries for domains. Jsonx example - replace 'baddomain.com' with your query - IP or domain:

<aside class="success">
Use JSONX if you require extended information regarding the queried host.
</aside>

### JSONX response:

It includes additional information about an IP address with fraudulent activity. This information is found in the 'extended' and 'emailsdaily' fields, e.g.:

### Query Parameters


```json
"extended": {
      "ASNum": "23969",
      "route": "1.0.200.0/24",
      "country": "AU",
      "domain": "veridas.net",
      "state": "",
      "time": "1486447729",

      "reason": {
        "class": "BOT",
        "rule": "9904",
        "type": "sinkhole"
        "name": "conficker",
        "source": "104.244.14.252",
        "port": "80",
        "sourceport": "23915",
        "destination": "1"
      }
    }
```

Parameter | Description
--------- | -----------
ASNum | The autonomous system number of the ISP;
route | The address of the network / subnet from which the activity originated;
country | The location of the above network;
domain | The associated domain with the ip address;
state | Display the state (if available);
time | The last registered activity timestamp in unix epoch format;
emailsdaily | Contains the number of detected spam emails in the last 24 hours;

For SMTP use, the `reason` JSON response will extend information based on the EHLO/SMTP reputation of the queried IP. Results include:

## Bot

JSONX provides extended information to protect your web-site or mobile application, especially for user signup forms, login and integrations to your application.

JSONX returns a `BOT` class, which represents one of the following 5 types:

### Sinkhole

```json
{"class":"BOT", "rule":"9091", "type":"sinkhole", "name":"marcher", "source":"216.218.185.162", "port":"80", "sourceport":"n/a", "destination":"onoven.com"}
```

Parameter | Description
--------- | -----------
Rule | The detection rule ID
Type | Sinkhole
Source | Source IP
Port | Source Port

### Web Server Compromises

```json
{"class":"BOT", "rule":"20062", "type":"spamlink", "domain":"www.thefashionic.com", "source":"1.53.132.24", "name":"gamut", "link":"https://www.thefashionic.com/wp-content/themes/thevoux-wp/f3ebf56b6f.html", "redirect":"https://targetsale.name"}
```

Parameter | Description
--------- | -----------
Rule | The detection rule ID
Type | Spamlink
Domain | Spam domain
Source | Source IP
Link | Typed link, e.g. as it appears to user
Redirect | Real link destination

### Web Server Attacks

```json
{"class":"BOT", "rule":"9051", "type":"web server attack", "name":"commentspammer"}
```

Parameter | Description
--------- | -----------
Rule | The detection rule ID
Type | Web Server Attack
Name | Extended Information

### Miscellaneous

In this case, attempted user and password are also listed. Note that these fields are not always present.

```json
{"class":"BOT", "rule":"9803", "type":"miscellaneous", "name":"iotwopbot", "user":"root", "password":"anko", "port":"5358", "source":"198.133.159.133", "sourceport":"53234", "domain":"-"}
```

Parameter | Description
--------- | -----------
Rule | The detection rule ID
Type | Miscellaneous
Name | Attack name
User | Attempted username login
Pass | Attempted password
Port | Port address
Source | Source IP
SourcePort | Source Port address
Domain | Domain specified

### Unknown

```json
{"class":"BOT", "rule":"3013", "type":"unknown", "name":"unknown3013", "halo":"pharmaccccyyy.ca"}
```

Parameter | Description
--------- | -----------
Rule | The detection rule ID
Type | Unknown
Name | Attack name
Halo | SMTP Halo specified

## SMTP

If using MQS for MTA/SMTP security, JSONX provides extended information that can assist with spam detection and email security for end-user mailboxes.

### LOC

```json
{"class":"LOC", "type":"helos as destination server"}
```

Parameter | Description
--------- | -----------
LOC | SMTP "helos" as destination server

### MPD

```json
{"class":"MPD", "type":"helos as multiple unrelated domains", "heloscount":"16", "domainscount":"16", "domains":["daycoonline.net", "e-apollo.lv", "exitprofit.com", "flammhotclicks.com", "ftc-i.net", "happyhumans.com", "hctc.net", "heronaerospace.com", "hi.nl", "hot.dog.cx", "i-love-cats.com", "investonline.biz", "kafen.com"]}
```

Parameter | Description
--------- | -----------
MPD | helos as multiple unrelated domains
heloscount | Number of unique HELO attempts
domainscount | Number of unique domains on HELO attempts
domains | JSON array for the domains used for HELO attempts

### Never

```json
{"class":"NEVER", "type":"forged helos", "halo":"hotmail.com"}
```

Parameter | Description
--------- | -----------
NEVER | Usually forged helos


### Misc

```json
{"class":"MISC", "type":"specific broken helos", "halo":"device.lan"}
```

Parameter | Description
--------- | -----------
MISC | Usually specific broken helos

### Bogus

```json
{"class":"BOGUS", "type":"multiple illegal helos", "halos":["impedibilityz","recanterp","stanchedb"]}
```

Parameter | Description
--------- | -----------
BOGUS | Multiple illegal helos
Halos | JSON array of malformed domains that do not comply with RFC822

### BSIP

```json
{"class":"BSIP", "type":"illegal helo as IP", "halo":"109.242.179.132"}
```

Parameter | Description
--------- | -----------
BSIP | Illegal helo`ing as IP
Halo | Malformed IP address used to HELO

### SSIP

```json
{"class":"SSIP", "type":"illegal helo as own IP", "halo":"120.215.192.35"}
```

Parameter | Description
--------- | -----------
SSIP | Illegal helo`ing as own IP
Halo | Source IP address

### LH

```json
{"class":"SSIP", "type":"illegal helo as own IP", "halo":"120.215.192.35"}
```

Parameter | Description
--------- | -----------
* LH | Variations on localhost

### FAM

```json
{"class":"FAM", "type":"helos as someone we know they`re not", "rdns":"ppp-93-104-64-20.dynamic.mnet-online.de", "halo":"striker.ottawa.on.ca"}
```

Parameter | Description
--------- | -----------
FAM | Helos as someone we know they`re not
rdns | Reverse dns of the offending IP

### NOHELO

```json
{"class":"NOHELO"}
```

Parameter | Description
--------- | -----------
NOHELO | Missing Helo

### HELI

```json
{"class":"HELI", "type":"special category", "halo":"test654.com"}
```

Parameter | Description
--------- | -----------
HELO | Special category for development purposes.


## Multiple items

```
http://api.metascan.io/v1/check/jsonx/127.9.9.1,baddomain.org,127.9.9.4,okdomain.org,::1
```

You can send multiple items in a single request. This will speed up the overall time for answering your query. Whenever possible, please use multiple items in a single query


## Browser access

- Point your browser to [https://metascan.io/query](https://metascan.io/query)

- Enter one or more IP addresses or domain names;

Click Check.

The service will return list of results with details on where the items were found, query time, and calculated score

Note: a 5 second delay is applied to all anonymous user queries. Please register to remove this delay.

# DNS API

We are providing an rbldns-like server that combines the information from all the sources we aggregate.

You should direct your DNS or anti-spam software to query `api.metascan.io`

The query string shall be the domain name or IP address, like:

`
baddomain.org
`

Or:

`127.9.9.1 or 1234:5678:9abc::`

_(not reversed IP, if query type is 'A')_

Or:

`reversed as 1.9.9.127.in-addr.arpa`

`0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.c.b.a.9.8.7.6.5.4.3.2.1.ip6.arpa`

_if query type is 'PTR'_

The server will reply either with a 127.x.x.x code (if the item is in our lists), or with NXDOMAIN response, if the item is not found.

<aside class="notice">
Note that for both IPv4 and IPv6 addresses we only return IPv4 response codes!
</aside>

<aside class="notice">
DNS queries from unregistered IP addresses will be rejected. You need to register all IPs of the machines issuing DNS queries to our servers.
</aside>

Sample dig syntax:

`dig @api.metascan.io baddomain.org`

Sample NSLOOKUP example:

`nslookup baddomain.org api.metascan.io`

Note: If you use Windows' nslookup, you must set the following options: nodefname, nosearch.

# DNS Response codes

## 127.0.0.x

Parameter | Description
--------- | -----------
127.0.0.x | PBL (Public/residential) IP adddresses from Spamhaus
127.0.0.10 | reported by ISP
127.0.0.11 | detected by Spamhaus
127.0.0.x | IP lists from Spamhaus
127.0.0.4 | XBL Illegal 3rd party exploits, including proxies, worms and trojan exploits
127.0.0.2 | SBL Spamhaus SBL Data
127.0.0.3 | SBL Spamhaus SBL CSS Data
127.0.0.9 | SBL Spamhaus DROP/EDROP Data

## 127.0.1.x

Parameter | Description
--------- | -----------
127.0.1.x | Domain lists from Spamhaus
127.0.1.2 | spam domain
127.0.1.4 | phish domain
127.0.1.5 | malware domain
127.0.1.6 | botnet C&C domain
127.0.1.102 | abused legit spam
127.0.1.103 | abused spammed redirector domain
127.0.1.104 | abused legit phish
127.0.1.105 | abused legit malware
127.0.1.106 | abused legit botnet C&C
127.0.1.200 | Zero reputation domain

## 127.1.0.x

Parameter | Description
--------- | -----------
127.1.0.x | Domain lists from URIBL
127.1.0.1 | Black
127.1.0.2 | Gold
127.1.0.3 | Grey
127.1.0.4 | Red

## 127.8.0.x

Parameter | Description
--------- | -----------
127.8.0.x | IP White lists from DNSWL
127.8.x.1 | None, auto-discovered
127.8.x.2 | Low ranking
127.8.x.3 | Medium ranking
127.8.x.4 | High ranking,

Where the third digit (x) means the type of industry:

Parameter | Description
--------- | -----------
2 | Financial services
3 | Email Service Providers
4 | Organisations (both for-profit [i.e. companies] and non-profit)
5 | Service/network providers
6 | Personal/private servers
7 | Travel/leisure industry
8 | Public sector/governments
9 | Media and Tech companies
10 | Some special cases
11 | Education, academic
12 | Healthcare
13 | Manufacturing/Industrial
14 | Retail/Wholesale/Services
15 | Email Marketing Providers
20 | Added through Self Service without specific category

# Metascan Overview

## Data & Access Methods

The MQS service is accessible via 6 different methods: Browser queries, 4 REST services (Text, HTTP, JSON, JSONx) and DNS.

Currently we derive our results from several providers, including:

* Spamhaus
* Spamhaus real time stream
* URIBL
* DNSWL.

We also apply internal algorithms for de-duplicating, normalizing and scoring each item in our database, providing a seamless and reliable API end-point for your application.

MSQ queries are answered in less than 1 millisecond, and expect no longer then 10 milliseconds for a query reply.

An MQS virtual appliance is also available for on-premises installation for super-fast access. Please contact us for details about that option.

All our sources are updated at very frequent intervals. We are also using real-time streams, so you may rest assured that you get the latest information from MQS.

## Score calculation

We are calculating the score for each item, based on where it is found, the additional information we have about the item (e.g. exploit type, bot, etc.) and whether it is found in one or more lists.

The minimum score is -0.1, meaning that an item was found in White List only. Score 0 means that the item is not found in our DB, and the maximum score is 1. In general, items with score above 0.35 shall be considered as spam or fraud.

# Data Sources

## IP Addresses sources

We aggregate data from several data streams: 

* Spamhaus PBL
* SBL
* XBL
* CBL
* Spamhaus Real-time stream.

On the other hand, we have also information about White Lists presence of IP address, for example DNSWL.

Unlike other lists, MQS analyzes the data about each IP address and provides normalized, de-duplicated, and pre-processed information about each IP address, containing internally calculated score (reputation), last modified timestamp, list of BL / WL where the item appears, etc.

## Domains sources

At this stage we aggregate data from two main Domain providers:

* Spamhaus DBL and URIBL
* Real-time Spamhaus ZRD (Zero Reputation Domains) list.

More providers will be added in the near future. Stay tuned!


